<div class="flex items-center mb-4 md:hidden">
  <h1 class="text-2xl font-medium text-fuchsia-950 flex items-center">
    Leaves
  </h1>
</div>

<div class="w-full mb-4">
  <form
    [formGroup]="searchForm"
    class="flex flex-col md:flex-row gap-2 justify-between"
  >
    <div class="flex flex-col md:flex-row gap-2">
      <div class="relative md:w-44">
        <select
          id="status"
          (change)="search()"
          formControlName="status"
          class="w-full px-3 py-1.5 border border-gray-300 rounded-lg focus:outline-none transition-all duration-200 appearance-none"
        >
          <option value="">All Status</option>
          <option value="pending">Pending</option>
          <option value="approved">Approved</option>
          <option value="rejected">Rejected</option>
        </select>
        <div
          class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"
        >
          <i class="fa-solid fa-chevron-down text-gray-400"></i>
        </div>
      </div>
      <div class="relative md:w-44">
        <select
          id="type"
          (change)="search()"
          formControlName="type"
          class="w-full px-3 py-1.5 border border-gray-300 rounded-lg focus:outline-none transition-all duration-200 appearance-none"
        >
          <option value="">All Leave</option>
          <option value="annual">Annual Leave</option>
          <option value="sick">Sick Leave</option>
          <option value="unpaid">Unpaid Leave</option>
        </select>
        <div
          class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"
        >
          <i class="fa-solid fa-chevron-down text-gray-400"></i>
        </div>
      </div>
    </div>
    <button
      type="button"
      (click)="openCreateModal()"
      class="bg-fuchsia-600 text-white px-5 py-1.5 rounded-lg hover:opacity-90 focus:outline-none focus:ring-1 focus:ring-fuchsia-500 focus:border-fuchsia-500 transition-all duration-200 font-medium shadow-lg transform hover:-translate-y-0.5"
    >
      Apply Leave
    </button>
  </form>
</div>

<div class="w-full overflow-x-auto">
  <table class="w-max min-w-full p-5 rounded-lg shadow-sm bg-white">
    <thead>
      <tr class="text-left text-gray-400">
        <th class="pl-8 pr-4 py-2">#</th>
        <th class="px-4 py-2">Type</th>
        <th class="px-4 py-2">From</th>
        <th class="px-4 py-2">To</th>
        <th class="px-4 py-2">Days</th>
        <th class="px-4 py-2">Status</th>
        <th class="px-4 py-2 text-center">
          <i class="fa-solid fa-ellipsis text-gray-400"></i>
        </th>
      </tr>
    </thead>
    <tbody>
      @for(leave of leaves; track leave.id; let idx = $index){
      <tr class="border-y border-gray-200">
        <td class="pl-8 pr-4 py-2">{{ idx + 1 }}</td>
        <td class="px-4 py-2">
          {{ leave.type | titlecase }}
        </td>
        <td class="px-4 py-2 text-nowrap">
          {{ leave.start_date | date : "longDate" }}
        </td>
        <td class="px-4 py-2 text-nowrap">
          {{ leave.end_date | date : "longDate" }}
        </td>
        <td class="px-4 py-2">
          {{ leave.total_days }}
        </td>
        <td class="px-4 py-2">
          {{ leave.status | titlecase }}
        </td>
        <td
          class="px-4 py-2 flex flex-row gap-2 justify-center items-center h-full text-gray-500"
        >
          <!-- edit -->
          <div
            class="hover:bg-green-100 px-2.5 py-1 rounded hover:text-green-500"
          >
            <i class="fa-solid fa-pen text-xs"></i>
          </div>
          <!-- delete -->
          <div
            class="hover:bg-rose-100 px-2.5 py-1 rounded hover:text-rose-500"
          >
            <i class="fa-solid fa-trash text-xs"></i>
          </div>
        </td>
      </tr>
      }
    </tbody>
  </table>
</div>

<div class="mt-4 flex justify-center">
  <nav class="flex items-center space-x-3 bg-fuchsia-50 rounded-xl p-3">
    <!--  previous-->
    @if(page > 1) {
    <a
      (click)="previous()"
      class="px-4 py-2 bg-white text-fuchsia-900 rounded-lg hover:bg-fuchsia-100 focus:outline-none focus:ring-1 focus:ring-fuchsia-300 transition-all duration-200 flex items-center"
    >
      <i class="fas fa-chevron-left mr-2"></i> Previous
    </a>
    }

    <!-- for page -->
    @for(value of getPages(); track value) {
    <!-- if active -->
    @if(value === page) {
    <a
      (click)="changePage(value)"
      class="px-4 py-2 bg-fuchsia-600 text-white rounded-lg hover:opacity-90 focus:outline-none focus:ring-1 focus:ring-fuchsia-300 transition-all duration-200 font-medium shadow-md"
    >
      {{ value }}
    </a>
    }
    <!-- if nonactive -->
    @else {
    <a
      (click)="changePage(value)"
      class="px-4 py-2 bg-white text-fuchsia-900 rounded-lg hover:bg-fuchsia-100 focus:outline-none focus:ring-1 focus:ring-fuchsia-300 transition-all duration-200 flex items-center"
    >
      {{ value }}
    </a>
    } }

    <!-- next  -->
    @if(page < totalPage) {
    <a
      (click)="next()"
      class="px-4 py-2 bg-white text-fuchsia-900 rounded-lg hover:bg-fuchsia-100 focus:outline-none focus:ring-1 focus:ring-fuchsia-300 transition-all duration-200 flex items-center"
    >
      Next <i class="fas fa-chevron-right ml-2"></i>
    </a>
    }
  </nav>
</div>

@if(isCreate) {
<app-leave-create
  (cancel)="closeCreateModal()"
  (refresh)="getLeaves()"
></app-leave-create>
}
