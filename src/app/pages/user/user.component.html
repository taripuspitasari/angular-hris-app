<div class="flex items-center mb-4 md:hidden">
  <h1 class="text-2xl font-medium text-fuchsia-950 flex items-center">User</h1>
</div>

<div class="w-full mb-4">
  <form
    [formGroup]="searchForm"
    (submit)="search()"
    class="flex flex-col md:flex-row gap-2 justify-between"
  >
    <div class="flex flex-col md:flex-row gap-2">
      <div class="relative">
        <div
          class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
        >
          <i class="fa-solid fa-magnifying-glass text-gray-300"></i>
        </div>
        <input
          type="text"
          class="focus:outline-none w-full placeholder:text-gray-300 border border-gray-300 pl-10 pr-3 py-1.5 rounded-lg"
          formControlName="name"
          placeholder="Search"
        />
      </div>
      <div class="relative md:w-44">
        <select
          id="role"
          formControlName="role"
          class="w-full px-3 py-1.5 border border-gray-300 rounded-lg focus:outline-none transition-all duration-200 appearance-none"
        >
          <option value="">All Role</option>
          <option value="employee">Employee</option>
          <option value="applicant">Applicant</option>
        </select>
        <div
          class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"
        >
          <i class="fa-solid fa-chevron-down text-gray-400"></i>
        </div>
      </div>
    </div>
    <button
      type="submit"
      class="bg-fuchsia-600 text-white font-medium px-5 py-1.5 rounded-lg hover:opacity-80 focus:outline-none focus:ring-1 focus:ring-fuchsia-500 focus:border-fuchsia-500 shadow-sm"
    >
      Search
    </button>
  </form>
</div>

<div class="w-full overflow-x-auto shadow-sm">
  <table class="w-max min-w-full p-5 rounded-lg shadow-sm bg-white">
    <thead>
      <tr class="text-left text-gray-400">
        <th class="pl-8 pr-4 py-2">#</th>
        <th class="px-4 py-2">Name</th>
        <th class="px-4 py-2">Role</th>
        <th class="px-4 py-2">Email</th>
        <th class="px-4 py-2 text-center">Active</th>
      </tr>
    </thead>
    <tbody>
      @for(user of users; track user.id; let idx = $index) {
      <tr class="border-y border-gray-200">
        <td class="pl-8 pr-4 py-2">{{ idx + 1 }}</td>
        <td class="px-4 py-2">
          {{ user.name }}
        </td>
        <td class="px-4 py-2 text-nowrap">
          {{ user.role | titlecase }}
        </td>
        <td class="px-4 py-2 text-nowrap">
          {{ user.email }}
        </td>

        <td
          class="px-4 py-2 flex flex-row gap-2 justify-center items-center h-full text-gray-500"
        >
          <div
            (click)="toggleActive(user)"
            class="px-2.5 py-1 rounded transition-colors duration-300 ease-in-out"
            [ngClass]="{
              'text-green-500': user.is_active,
              'text-gray-500 rotate-180': user.is_active
            }"
          >
            <i class="fa-solid fa-toggle-on"></i>
          </div>
        </td>
      </tr>
      }
    </tbody>
  </table>
</div>

<div class="mt-4 flex justify-center">
  <nav class="flex items-center space-x-3 bg-fuchsia-50 rounded-xl p-3">
    <!--  previous-->
    @if(page > 1) {
    <a
      (click)="previous()"
      class="px-4 py-2 bg-white text-fuchsia-900 rounded-lg hover:bg-fuchsia-100 focus:outline-none focus:ring-1 focus:ring-fuchsia-300 transition-all duration-200 flex items-center"
    >
      <i class="fas fa-chevron-left mr-2"></i> Previous
    </a>
    }

    <!-- for page -->
    @for(value of getPages(); track value) {
    <!-- if active -->
    @if(value === page) {
    <a
      (click)="changePage(value)"
      class="px-4 py-2 bg-fuchsia-600 text-white rounded-lg hover:opacity-90 focus:outline-none focus:ring-1 focus:ring-fuchsia-300 transition-all duration-200 font-medium shadow-md"
    >
      {{ value }}
    </a>
    }
    <!-- if nonactive -->
    @else {
    <a
      (click)="changePage(value)"
      class="px-4 py-2 bg-white text-fuchsia-900 rounded-lg hover:bg-fuchsia-100 focus:outline-none focus:ring-1 focus:ring-fuchsia-300 transition-all duration-200 flex items-center"
    >
      {{ value }}
    </a>
    } }

    <!-- next  -->
    @if(page < totalPage) {
    <a
      (click)="next()"
      class="px-4 py-2 bg-white text-fuchsia-900 rounded-lg hover:bg-fuchsia-100 focus:outline-none focus:ring-1 focus:ring-fuchsia-300 transition-all duration-200 flex items-center"
    >
      Next <i class="fas fa-chevron-right ml-2"></i>
    </a>
    }
  </nav>
</div>

@if(isUpdate) {
<app-modal
  title="Update Status Confirmation"
  (cancel)="closeUpdateModal()"
  (confirm)="update()"
>
  <p>
    Are you sure you want to update status
    <strong>{{ selectedUser?.name }}</strong
    >?
  </p>
</app-modal>
}
